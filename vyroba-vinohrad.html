<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <title>Drunk - Punk</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #fef6fa 0%, #e1fcff 100%);
      margin: 0; padding: 0; text-align: center;
    }
    .nav-bar {
      position: fixed;
      top: 0; left: 0; width: 100vw;
      background: #2196f3; color: white;
      display: flex; justify-content: flex-end; gap: 2px;
      z-index: 1000; box-shadow: 0 2px 8px #0002; padding: 7px 0;
    }
    .nav-link {
      color: white; padding: 7px 24px; text-decoration: none;
      font-weight: bold; font-size: 1.07em; border-radius: 0 0 10px 10px;
      transition: background 0.18s; display: flex; align-items: center; gap: 6px;
    }
    .nav-link.active, .nav-link:hover { background: #1760a3; }
    body { padding-top: 48px; }
    .zpet-link {
      display: inline-block;
      margin: 20px 0 4px 0;
      color: #1760a3;
      background: #e9f6fd;
      padding: 7px 17px;
      border-radius: 9px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.08em;
      box-shadow: 0 1px 8px #bbe8fd44;
      transition: background 0.13s, color 0.13s;
    }
    .zpet-link:hover { background: #b7e0ed; color: #124061; }
    h2 { margin: 16px 0 7px 0; color: #208278; font-size: 2.35em;}
    .section {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 2px 14px #b7d9db35;
      display: inline-block;
      margin: 14px auto 0 auto;
      padding: 16px 17px 13px 17px;
      min-width: 220px; max-width: 98vw; text-align: left;
    }
    .section-title { color: #217c5e; font-size: 1.13em; margin-bottom: 8px; font-weight: 700; letter-spacing: 1px; }
    .status { color:#b24b4b; font-weight:600; margin-bottom:10px;}
    .success { color:#217c5e; }
    .prod-btn {
      background: #37af7b; color: #fff; border: none;
      border-radius: 7px; font-size: 1em; margin: 6px 0 10px 0;
      padding: 5px 20px; cursor: pointer;
    }
    .prod-btn:hover { background: #136652; }
    .prod-btn[disabled] { background: #9dbdae; cursor: not-allowed;}
    .machines-list {margin-bottom:14px;}
    .machines-list span {background:#e9dcb4;border-radius:7px;padding:5px 14px 4px 11px;font-size:1em;margin:0 7px 5px 0;display:inline-block;}
    .need {color:#b24b4b;}
    .has {color:#217c5e;}
    .cards-flex {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 34px; margin-bottom: 6px;
    }
    .phase-card {
      background: #f8fcf7; border-radius: 14px; box-shadow: 0 2px 12px #b7d9db33;
      padding: 20px 23px 18px 23px; min-width: 230px; max-width: 340px;
      margin: 6px 6px 0 6px; display: flex; flex-direction: column; align-items: center;
      border-top: 7px solid #37af7b; transition: box-shadow .18s;
    }
    .phase-card.kad { border-top-color: #ffd748; }
    .phase-card.lis { border-top-color: #7fc9ff; }
    .phase-title { font-size: 1.17em; font-weight: 700; color: #136652; margin-bottom: 6px;
      display: flex; align-items: center; gap: 8px; }
    .phase-icon { font-size: 2em; }
    .phase-prog { width: 100%; }
    .phase-info { font-size: 1em; margin: 4px 0 7px 0;}
    .progress-container {
      width: 100%; background-color: #e0e0e0; border-radius: 8px; height: 12px;
      margin-top: 8px; position: relative; overflow: hidden;
    }
    .progress-bar {
      height: 100%; background-color: #37af7b; width: 0%; transition: width 1s linear;
    }
    .progress-text {
      font-size: 0.97em; margin-top: 6px; color: #555; font-weight: bold; text-align: center;
    }
    @media (max-width:900px) {
      .cards-flex { flex-direction: column; align-items: center; gap: 14px;}
      .phase-card { min-width: 220px; max-width: 99vw;}
    }
    @media (max-width:600px){
      body { padding-top: 90px; }
      .nav-bar { justify-content: center; flex-wrap: wrap; font-size: 0.97em; }
      .nav-link { padding:7px 8px;font-size:1em; }
      .section { padding:10px; }
      h2 { font-size: 2.1em; }
      .zpet-link { padding: 7px 6vw; font-size:1em;}
    }
  </style>
</head>
<body>
  <div class="nav-bar">
    <a href="pestovani.html" class="nav-link">üå± Grow Sh*t</a>
<a href="vyroba.html" class="nav-link active">‚öóÔ∏è Brewing</a>
<a href="jzd.html" class="nav-link">üê∑ Coop</a>
<a href="sklad.html" class="nav-link">üì¶ Stash</a>
<a href="finance.html" class="nav-link">üí∞ Wallet</a>
<a href="hotel.html" class="nav-link">üè® Motel</a>
<a href="pub.html" class="nav-link">üè° Bar</a>
<a href="market.html" class="nav-link">üè™ Bazaar</a>
  </div>
  <a href="vyroba.html" class="zpet-link">‚Üê Back to production</a>
  <h2>üçá Vineyard</h2>
  <div id="balances" style="text-align:center; margin: 10px 0; font-weight: bold; font-size: 1.2em;">
 <b>üíµ Balance: <span id="stavPrachy"></span><br>
  ü™ô PI Coins: <span id="pi-balance"></span></b> œñ
</div>
  <div class="section" id="machinesSection"></div>
  <div class="cards-flex" id="vinoSection"></div>
  <div class="section" id="vyrobaStatus"></div>
  <script>
  var productionInterval = null;

  if (!localStorage.getItem("lihobaronFarmStorage")) {
  localStorage.setItem("lihobaronFarmStorage", JSON.stringify({
    p≈°enice: 0, chmel: 0, kuku≈ôice: 0, reva: 0, jablko: 0, hru≈°ky: 0, ≈°vestky: 0,
    meru≈àky: 0, broskve: 0, mrkev: 0, brambora: 0, rajƒçata: 0, chilli: 0,
    okurky: 0, t≈ôe≈°nƒõ: 0, cibule: 0, ƒçesnek: 0, jahody: 0, kvas_vino: 0, vino: 0, most_cider: 0, cider: 0,
  }));
}
 if (!localStorage.getItem("lihobaronFarmSeeds")) {
  localStorage.setItem("lihobaronFarmSeeds", JSON.stringify({
    p≈°enice: 0, chmel: 0, kuku≈ôice: 0, reva: 0, jablko: 0, hru≈°ka: 0, ≈°vestka: 0,
    meru≈àka: 0, broskev: 0, mrkev: 0, brambora: 0, rajƒçata: 0, chilli: 0,
    okurky: 0, t≈ôe≈°nƒõ: 0, cibule: 0, ƒçesnek: 0, jahody: 0
  }));
}
if (!localStorage.getItem("lihobaronFarmXP")) {
  localStorage.setItem("lihobaronFarmXP", 0);
}
if (!localStorage.getItem("lihobaronFarmCoins")) {
  localStorage.setItem("lihobaronFarmCoins", 200);
}
if (!localStorage.getItem("lihobaronPi")) {
  localStorage.setItem("lihobaronPi", 200);
}
function getPi() {
  return JSON.parse(localStorage.getItem("lihobaronPi") || "0");
}

function renderPiBalance() {
  document.getElementById("pi-balance").textContent = getPi();
} 
// ---- LocalStorage helpers ----
    function load(key, def) { try { let d=localStorage.getItem(key); if(!d)return def; return JSON.parse(d);}catch{return def;} }
    function save(key, val) { localStorage.setItem(key, JSON.stringify(val)); }
    function getMoney() { return load("lihobaronFarmCoins", 0);}
    function setMoney(m) { save("lihobaronFarmCoins", m);}
    function getSklad() { return load("lihobaronFarmStorage", {});}
    function setSklad(s) { save("lihobaronFarmStorage", s);}
    function getMachines() { return load("lihobaronMachines", []);}
    function setMachines(arr) { save("lihobaronMachines", arr);}
    function getProductions() { return load("lihobaronProductions", []);}
    function setProductions(arr) { save("lihobaronProductions", arr); }
    function stavPrachy() { document.getElementById("stavPrachy").innerText = getMoney()+" $"; }
    function vypisStatus(txt,ok){ let e=document.getElementById("vyrobaStatus"); e.innerHTML="<span class='"+(ok?"success":"status")+"'>"+txt+"</span>"; setTimeout(()=>{e.innerHTML='';},2300);}
    // ---- Stroje a ƒçasy ----
   const VINO_MACHINES = [
  { key:"lis_vino",   name:"Wine press üçáüçé",    price: 900 },
  { key:"kad_vino",   name:"Wine tub üçæüç∂",    price: 1100 }
];
   const VINO_TIMES = {
  "kvasit_vino": 510,
  "lisovat_vino": 310,
  "lisovat_cider": 310,
  "kvasit_cider": 510
};
    // ---- Obchod se stroji ----
    function renderMachinesShop() {
      const machines = getMachines();
      let html = "<div class='section-title'>üõí Machine shop</div>";
      html += "<div class='machines-list'>";
      VINO_MACHINES.forEach(m=>{
        if (machines.includes(m.key)) {
          html += `<span class='has'>${m.name} ‚úîÔ∏è</span>`;
        } else {
          html += `<span class='need'>${m.name} (${m.price} $) 
            <button class='prod-btn' onclick="kupitStroj('${m.key}',${m.price})">Buy</button></span>`;
        }
      });
      html += "</div>";
      document.getElementById("machinesSection").innerHTML = html;
    }
    function kupitStroj(key, cena) {
      let machines = getMachines();
      let money = getMoney();
      if (machines.includes(key)) { vypisStatus("You already got this machine!",0); return; }
      if (money < cena) { alert("Not enough money!"); return; }
      machines.push(key);
      setMachines(machines);
      setMoney(money-cena);
      vypisStatus("Machine bought!",1);
      stavPrachy();
      renderMachinesShop();
      vykresliVino();
    }
 function vykresliVino() {
  var machines = getMachines();
  var sklad = getSklad();
  var prods = getProductions();
  var html = "";

  // 1. Lisov√°n√≠ v lisu (z r√©vy ‚Üí kvas)
  html += "<div class='phase-card lis'>";
  html += "<div class='phase-title'><span class='phase-icon'>üçá</span> Pressing grapes</div>";
  html += "<div class='phase-info'><b>Needs:</b> 1√ó grape</div>";
  if (machines.includes("lis_vino")) {
    var reva = sklad["reva"] || 0;
    var kvasVino = sklad["kvas_vino"] || 0;
    var prod = prods.find(function(p) { return p.type === "lisovat_vino" && !p.done; });
    html += "<div class='phase-prog'><b>Wine mash:</b> <span class='has'>" + kvasVino + " ks</span><br>";
    if (prod) {
      if (prod.ready) {
        html += "<button class='prod-btn' onclick=\"sebratVyrobu('lisovat_vino')\">Collect</button>";
      } else {
        html += renderProgress(prod, "lisovat_vino");
      }
    } else if (reva > 0) {
      html += "<button class='prod-btn' onclick=\"startProduction('lisovat_vino')\" id='btnLisovatVino'>Start pressing</button>";
    } else {
      html += "<span class='need'>No grapes!</span>";
    }
    html += "</div>";
  } else {
    html += "<div class='phase-prog'><span class='need'>You need a wine press first!</span></div>";
  }
  html += "</div>";

  // 2. Kva≈°en√≠ v k√°di (z kvasu ‚Üí v√≠no)
  html += "<div class='phase-card kad'>";
  html += "<div class='phase-title'><span class='phase-icon'>üçæ</span> Fermenting wine</div>";
  html += "<div class='phase-info'><b>Needs:</b> 1√ó wine mash</div>";
  if (machines.includes("kad_vino")) {
    var kvasVino2 = sklad["kvas_vino"] || 0;
    var vino = sklad["vino"] || 0;
    var prod2 = prods.find(function(p) { return p.type === "kvasit_vino" && !p.done; });
    html += "<div class='phase-prog'><b>Wine:</b> <span class='has'>" + vino + " ks</span><br>";
    if (prod2) {
      if (prod2.ready) {
        html += "<button class='prod-btn' onclick=\"sebratVyrobu('kvasit_vino')\">Collect</button>";
      } else {
        html += renderProgress(prod2, "kvasit_vino");
      }
    } else if (kvasVino2 > 0) {
      html += "<button class='prod-btn' onclick=\"startProduction('kvasit_vino')\" id='btnKvasitVino'>Start fermenting</button>";
    } else {
      html += "<span class='need'>No wine mash!</span>";
    }
    html += "</div>";
  } else {
    html += "<div class='phase-prog'><span class='need'>You need a wine tub first!</span></div>";
  }
  html += "</div>";

  // 3. Lisov√°n√≠ jablek (na mo≈°t)
  html += "<div class='phase-card lis'>";
  html += "<div class='phase-title'><span class='phase-icon'>üçè</span> Pressing apples</div>";
  html += "<div class='phase-info'><b>Needs:</b> 1√ó apple</div>";
  if (machines.includes("lis_vino")) {
    var jablko = sklad["jablko"] || 0;
    var mostCider = sklad["most_cider"] || 0;
    var prod3 = prods.find(function(p) { return p.type === "lisovat_cider" && !p.done; });
    html += "<div class='phase-prog'><b>Juice:</b> <span class='has'>" + mostCider + " ks</span><br>";
    if (prod3) {
      if (prod3.ready) {
        html += "<button class='prod-btn' onclick=\"sebratVyrobu('lisovat_cider')\">Collect</button>";
      } else {
        html += renderProgress(prod3, "lisovat_cider");
      }
    } else if (jablko > 0) {
      html += "<button class='prod-btn' onclick=\"startProduction('lisovat_cider')\" id='btnLisovatCider'>Start pressing</button>";
    } else {
      html += "<span class='need'>No apples!</span>";
    }
    html += "</div>";
  } else {
    html += "<div class='phase-prog'><span class='need'>You need a wine press first!</span></div>";
  }
  html += "</div>";

  // 4. Kva≈°en√≠ mo≈°tu (na cider)
  html += "<div class='phase-card kad'>";
  html += "<div class='phase-title'><span class='phase-icon'>üç∫</span> Fermenting cider</div>";
  html += "<div class='phase-info'><b>Needs:</b> 1√ó juice</div>";
  if (machines.includes("kad_vino")) {
    var mostCider2 = sklad["most_cider"] || 0;
    var cider = sklad["cider"] || 0;
    var prod4 = prods.find(function(p) { return p.type === "kvasit_cider" && !p.done; });
    html += "<div class='phase-prog'><b>Cider:</b> <span class='has'>" + cider + " ks</span><br>";
    if (prod4) {
      if (prod4.ready) {
        html += "<button class='prod-btn' onclick=\"sebratVyrobu('kvasit_cider')\">Collect</button>";
      } else {
        html += renderProgress(prod4, "kvasit_cider");
      }
    } else if (mostCider2 > 0) {
      html += "<button class='prod-btn' onclick=\"startProduction('kvasit_cider')\" id='btnKvasitCider'>Start fermenting</button>";
    } else {
      html += "<span class='need'>No juice!</span>";
    }
    html += "</div>";
  } else {
    html += "<div class='phase-prog'><span class='need'>You need a wine tub first!</span></div>";
  }
  html += "</div>";

  document.getElementById("vinoSection").innerHTML = html;
  stavPrachy();
}

// ---- Progress bary atd ----
    function renderProgress(prod, typ) {
      let secondsLeft = Math.max(0, Math.ceil((prod.started + prod.duration*1000 - Date.now())/1000));
      let percent = Math.min(100, 100-100*secondsLeft/prod.duration);
      let id = `prodTimer_${prod.type}`;
      return `<div class="progress-container"><div class="progress-bar" id="pb_${id}" style="width:${percent}%"></div></div>
              <div class="progress-text">Time left: <span id="${id}">${formatTime(secondsLeft)}</span></div>`;
    }
    function formatTime(secs) {
      if (secs < 60) return secs + "s";
      let min = Math.floor(secs/60);
      let s = secs % 60;
      return min + "m " + s + "s";
    }
    function startProduction(type) {
  const sklad = getSklad();
  let prods = getProductions();
  if (prods.find(p => p.type === type && !p.done)) return;

  // Kontroly surovin
  if (type === "lisovat_vino" && (sklad["reva"] || 0) < 1) return;
  if (type === "kvasit_vino" && (sklad["kvas_vino"] || 0) < 1) return;
  if (type === "lisovat_cider" && (sklad["jablko"] || 0) < 1) return;
  if (type === "kvasit_cider" && (sklad["most_cider"] || 0) < 1) return;

  // Odeƒçet surovin
  if (type === "lisovat_vino") sklad["reva"]--;
  if (type === "kvasit_vino") sklad["kvas_vino"]--;
  if (type === "lisovat_cider") sklad["jablko"]--;
  if (type === "kvasit_cider") sklad["most_cider"]--;

  setSklad(sklad);

  prods.push({
    type,
    started: Date.now(),
    duration: VINO_TIMES[type] || 20,
    done: false
  });

  setProductions(prods);
  vykresliVino();
  runProductionTimers();
}
   function sebratVyrobu(type) {
  let prods = getProductions();
  let sklad = getSklad();

  // Podle typu v√Ωroby p≈ôiƒçti v√Ωstup
  if (type === "lisovat_vino")   sklad["kvas_vino"] = (sklad["kvas_vino"] || 0) + 1;
  if (type === "kvasit_vino")    sklad["vino"] = (sklad["vino"] || 0) + 1;
  if (type === "lisovat_cider")  sklad["most_cider"] = (sklad["most_cider"] || 0) + 1;
  if (type === "kvasit_cider")   sklad["cider"] = (sklad["cider"] || 0) + 1;

  setSklad(sklad);

  // Vyma≈æ hotovou v√Ωrobu z pole (ready==true)
  prods = prods.filter(p => !(p.type === type && p.ready));
  setProductions(prods);

  vypisStatus("Production collected!", 1);

  vykresliVino();
}

function runProductionTimers() {
  if (productionInterval) clearInterval(productionInterval);

  productionInterval = setInterval(() => {
    let prods = getProductions();
    let now = Date.now();
    let zmƒõna = false;

    prods.forEach((prod) => {
      if (prod.done || prod.ready) return;  // Pozor na ready!
      let secondsLeft = Math.max(0, Math.ceil((prod.started + prod.duration * 1000 - now) / 1000));
      let percent = Math.min(100, 100 - (100 * secondsLeft / prod.duration));

      let id = "prodTimer_" + prod.type;
      let timerSpan = document.getElementById(id);
      if (timerSpan) timerSpan.textContent = formatTime(secondsLeft);

      let bar = document.getElementById('pb_' + id);
      if (bar) bar.style.width = percent + "%";

      if (secondsLeft <= 0) {
        prod.ready = true; // Jen nastav√≠≈° ‚Äûƒçek√° na sebr√°n√≠‚Äú
        zmƒõna = true;
      }
    });

    if (zmƒõna) {
      setProductions(prods);
      vykresliVino();
    }
  }, 1000);
}
function checkOfflineProductions() {
  let prods = getProductions();
  let now = Date.now();
  let zmƒõna = false;

  prods.forEach((prod) => {
    if (!prod.done && !prod.ready && (prod.started + prod.duration * 1000 <= now)) {
      prod.ready = true;
      zmƒõna = true;
    }
  });

  if (zmƒõna) setProductions(prods);
}
   
window.onload = function() {
      checkOfflineProductions();
      renderMachinesShop();
      vykresliVino();
      stavPrachy();
      renderPiBalance()
      runProductionTimers();
    };
  </script>
</body>
</html>
